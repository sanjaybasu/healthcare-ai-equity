---
layout: default
mathjax: true
---

<article class="chapter-content">
  {{ content }}
</article>

<!-- Auto-generate collapsible table of contents from h2 and h3 headings -->
<script>
  document.addEventListener('DOMContentLoaded', function() {
    const article = document.querySelector('.chapter-content');
    const headings = article.querySelectorAll('h2, h3');
    
    if (headings.length > 3) {
      const toc = document.createElement('nav');
      toc.className = 'table-of-contents';
      
      // Create collapsible header
      const tocHeader = document.createElement('h2');
      tocHeader.innerHTML = 'Table of Contents <span style="float:right; font-size: 0.8em;">▼</span>';
      toc.appendChild(tocHeader);
      
      // Create TOC list
      const tocList = document.createElement('ul');
      
      headings.forEach((heading, index) => {
        // Add ID to heading if it doesn't have one
        if (!heading.id) {
          heading.id = 'section-' + index;
        }
        
        const li = document.createElement('li');
        li.className = heading.tagName.toLowerCase();
        
        const link = document.createElement('a');
        link.href = '#' + heading.id;
        link.textContent = heading.textContent;
        
        li.appendChild(link);
        tocList.appendChild(li);
      });
      
      toc.appendChild(tocList);
      
      // Make header collapsible
      tocHeader.style.cursor = 'pointer';
      tocHeader.style.userSelect = 'none';
      
      tocHeader.addEventListener('click', function() {
        const isHidden = tocList.style.display === 'none';
        tocList.style.display = isHidden ? 'block' : 'none';
        const arrow = tocHeader.querySelector('span');
        arrow.textContent = isHidden ? '▼' : '▶';
      });
      
      // Insert TOC after the first paragraph or at the beginning
      const firstPara = article.querySelector('p');
      if (firstPara) {
        firstPara.parentNode.insertBefore(toc, firstPara.nextSibling);
      } else {
        article.insertBefore(toc, article.firstChild);
      }
      
      // Smooth scroll behavior for TOC links
      tocList.querySelectorAll('a').forEach(link => {
        link.addEventListener('click', function(e) {
          e.preventDefault();
          const targetId = this.getAttribute('href').substring(1);
          const targetElement = document.getElementById(targetId);
          if (targetElement) {
            targetElement.scrollIntoView({ behavior: 'smooth', block: 'start' });
            // Update URL without jumping
            history.pushState(null, null, '#' + targetId);
          }
        });
      });
    }
  });
</script>
