---
layout: default
mathjax: true
---

<article class="chapter-content">
  {{ content }}
</article>

<!-- Auto-generate collapsible table of contents with auto-collapse on scroll -->
<script>
  document.addEventListener('DOMContentLoaded', function() {
    const article = document.querySelector('.chapter-content');
    const headings = article.querySelectorAll('h2, h3');
    
    if (headings.length > 3) {
      const toc = document.createElement('nav');
      toc.className = 'table-of-contents';
      
      // Create collapsible header
      const tocHeader = document.createElement('h2');
      tocHeader.innerHTML = 'Table of Contents <span style="float:right; font-size: 0.8em;">▼</span>';
      toc.appendChild(tocHeader);
      
      // Create TOC list
      const tocList = document.createElement('ul');
      
      headings.forEach((heading, index) => {
        if (!heading.id) {
          heading.id = 'section-' + index;
        }
        
        const li = document.createElement('li');
        li.className = heading.tagName.toLowerCase();
        
        const link = document.createElement('a');
        link.href = '#' + heading.id;
        link.textContent = heading.textContent;
        
        li.appendChild(link);
        tocList.appendChild(li);
      });
      
      toc.appendChild(tocList);
      
      // Make header collapsible
      tocHeader.style.cursor = 'pointer';
      tocHeader.style.userSelect = 'none';
      
      const toggleToc = function(shouldCollapse) {
        tocList.style.display = shouldCollapse ? 'none' : 'block';
        const arrow = tocHeader.querySelector('span');
        arrow.textContent = shouldCollapse ? '▶' : '▼';
      };
      
      tocHeader.addEventListener('click', function() {
        const isHidden = tocList.style.display === 'none';
        toggleToc(!isHidden);
      });
      
      // Auto-collapse on scroll
      let tocCollapsed = false;
      
      window.addEventListener('scroll', function() {
        const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
        
        if (scrollTop > 300 && !tocCollapsed) {
          toggleToc(true);
          tocCollapsed = true;
        } 
        else if (scrollTop < 200 && tocCollapsed) {
          toggleToc(false);
          tocCollapsed = false;
        }
      }, { passive: true });
      
      // Smart TOC placement - after learning objectives
      let insertAfter = null;
      
      // Look for the first list (ul/ol) which is likely learning objectives
      const firstList = article.querySelector('ul, ol');
      if (firstList) {
        insertAfter = firstList;
      }
      
      // If no list found, use the third paragraph (skip intro paragraphs)
      if (!insertAfter) {
        const paragraphs = article.querySelectorAll('p');
        if (paragraphs.length >= 3) {
          insertAfter = paragraphs[2];
        } else if (paragraphs.length > 0) {
          insertAfter = paragraphs[paragraphs.length - 1];
        }
      }
      
      // Insert TOC
      if (insertAfter && insertAfter.parentNode) {
        insertAfter.parentNode.insertBefore(toc, insertAfter.nextSibling);
      } else {
        article.insertBefore(toc, article.firstChild);
      }
      
      // Smooth scroll for TOC links
      tocList.querySelectorAll('a').forEach(link => {
        link.addEventListener('click', function(e) {
          e.preventDefault();
          const targetId = this.getAttribute('href').substring(1);
          const targetElement = document.getElementById(targetId);
          if (targetElement) {
            targetElement.scrollIntoView({ behavior: 'smooth', block: 'start' });
            history.pushState(null, null, '#' + targetId);
          }
        });
      });
    }
  });
</script>
