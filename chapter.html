---
layout: default
mathjax: true
---

<article class="chapter-content">
  {{ content }}
</article>

<!-- Table of contents generation - NOT sticky, inserted into content -->
<script>
  document.addEventListener('DOMContentLoaded', function() {
    const article = document.querySelector('.chapter-content');
    const headings = article.querySelectorAll('h2, h3');
    
    // Only create TOC if there are enough headings
    if (headings.length > 3) {
      const toc = document.createElement('nav');
      toc.className = 'table-of-contents';
      toc.innerHTML = '<h2>Table of Contents</h2>';
      
      const tocList = document.createElement('ul');
      
      headings.forEach((heading, index) => {
        // Add ID to heading if it doesn't have one
        if (!heading.id) {
          heading.id = 'section-' + index;
        }
        
        const li = document.createElement('li');
        li.className = heading.tagName.toLowerCase();
        
        const link = document.createElement('a');
        link.href = '#' + heading.id;
        link.textContent = heading.textContent;
        
        li.appendChild(link);
        tocList.appendChild(li);
      });
      
      toc.appendChild(tocList);
      
      // Insert TOC after learning objectives or first paragraph
      // Look for "Learning Objectives" heading
      const learningObjectivesHeading = Array.from(article.querySelectorAll('h2')).find(
        h => h.textContent.toLowerCase().includes('learning objectives')
      );
      
      if (learningObjectivesHeading) {
        // Find the next h2 after learning objectives
        let nextSection = learningObjectivesHeading.nextElementSibling;
        while (nextSection && nextSection.tagName !== 'H2') {
          nextSection = nextSection.nextElementSibling;
        }
        
        if (nextSection) {
          // Insert TOC right before the next major section
          nextSection.parentNode.insertBefore(toc, nextSection);
        } else {
          // If no next section, insert at end
          article.appendChild(toc);
        }
      } else {
        // Fallback: insert after first paragraph
        const firstPara = article.querySelector('p');
        if (firstPara) {
          firstPara.parentNode.insertBefore(toc, firstPara.nextSibling);
        } else {
          article.insertBefore(toc, article.firstChild);
        }
      }
    }
    
    // Smooth scroll for TOC links
    document.querySelectorAll('.table-of-contents a').forEach(link => {
      link.addEventListener('click', function(e) {
        e.preventDefault();
        const target = document.querySelector(this.getAttribute('href'));
        if (target) {
          target.scrollIntoView({ behavior: 'smooth', block: 'start' });
          // Offset for sticky nav
          window.scrollBy(0, -80);
        }
      });
    });
  });
</script>

<style>
/* Make sure TOC is NOT sticky */
.table-of-contents {
  position: static !important; /* Override any sticky positioning */
  background: var(--bg-gray, #f7fafc);
  border: 1px solid var(--border, #e2e8f0);
  border-radius: 5px;
  padding: 1.5rem;
  margin: 2rem 0;
  max-width: 100%;
}

.table-of-contents h2 {
  margin-top: 0 !important;
  margin-bottom: 1rem;
  font-size: 1.2rem;
  border: none;
  padding: 0;
}

.table-of-contents ul {
  list-style: none;
  margin: 0;
  padding: 0;
}

.table-of-contents li {
  margin-bottom: 0.5rem;
  padding-left: 0;
}

.table-of-contents li.h3 {
  margin-left: 1.5rem;
  font-size: 0.95rem;
}

.table-of-contents a {
  color: var(--text, #2d3748);
  text-decoration: none;
  display: block;
  padding: 0.25rem 0;
  transition: color 0.2s;
}

.table-of-contents a:hover {
  color: var(--secondary, #4a90a4);
}
</style>
